MENUITEM_LENGTH			EQU		80

NUM_MAINMENU_OPTIONS	EQU		2

MAINMENU_ITEMNUM_BOOTMENU		EQU		1
MAINMENU_ITEMNUM_CMOSMENU		EQU		0

MAINMENU				PROC

						CALL	BOOTMENU	; Go to BOOT MENU first

MAINMENU_OUTER_LOOP:
						CALL	MENU_WAIT_PAD_RELEASE

						CALL	CLEAR_FIVE_BELOW

						MOV		SI,OFFSET MAINMENU_ITEM_BUFFER
						MOV		CX,NUM_MAINMENU_OPTIONS
						CALL	DRAWMENU

						MOV		AX,DISPLACED_DEMOSPLASh_MESSAGE_LOCATION
						CALL	DEMOSPLASH_MESSAGE_MOVABLE

						MOV		CL,NUM_MAINMENU_OPTIONS
						MOV		AL,CS:[MAINMENU_SELECTION]
						CALL	DRAWARROW

@@:
						CALL	READ_PADA
						CMP		AL,3FH
						JE		@b

						MOV		AH,CS:[MAINMENU_SELECTION]
						MOV		CH,NUM_MAINMENU_OPTIONS
						CALL	MOVE_ARROW_BY_PAD
						MOV		CS:[MAINMENU_SELECTION],AH

						AND		AL,30H
						CMP		AL,30H
						JE		MAINMENU_OUTER_LOOP

						;	AH is still Selection
						CMP		AH,MAINMENU_ITEMNUM_CMOSMENU
						JNE		@f
						CALL	CMOSMENU
						JMP		MAINMENU_OUTER_LOOP

@@:
						CMP		AH,MAINMENU_ITEMNUM_BOOTMENU
						JNE		@f
						CALL	BOOTMENU
						JMP		MAINMENU_OUTER_LOOP

@@:
						JMP		MAINMENU_OUTER_LOOP

MAINMENU				ENDP



MAINMENU_SELECTION		DB		0
	                           ; 01234567890123456789012345678901234567890123456789012345678901234567890123456789
MAINMENU_ITEM_BUFFER	DB		"DRIVE LETTER ASSIGNMENTS                                                       ",0
						DB		"BOOT MENU                                                                      ",0


; Input
;   AL Pad
;   AH Current Selection
;   CH Number of Choices
; Output
;   AH New Selection
MOVE_ARROW_BY_PAD		PROC
						TEST	AL,2
						JE		MOVE_ARROW_BY_PAD_DOWN
						TEST	AL,1
						JE		MOVE_ARROW_BY_PAD_UP
						RET

MOVE_ARROW_BY_PAD_DOWN:
						INC		AH
						CMP		AH,CH
						JL		@f
						XOR		AH,AH
						RET

MOVE_ARROW_BY_PAD_UP:
						SUB		AH,1
						JAE		@f
						MOV		AH,CH
						DEC		AH
@@:
						RET

MOVE_ARROW_BY_PAD		ENDP




; INPUT
;   AL PAD
; OUTPUT
;   BX  -1 LEFT
;        0 NEUTRAL
;        1 RIGHT
;   ZF=0 IF LEFT OR RIGHT,  ZF=1 IF NEUTRAL
PAD_TO_LEFT_RIGHT		PROC
						TEST	AL,40H
						JNE		@f
						MOV		BX,1
						AND		BX,BX
						RET
@@:
						TEST	AL,20H
						JNE		@f
						MOV		BX,-1
@@:
						AND		BX,BX
						RET
PAD_TO_LEFT_RIGHT		ENDP




; INPUT/OUTPUT
;	AL
TOGGLE_1_0				PROC
						AND		AL,1
						XOR		AL,1
						RET

TOGGLE_1_0				ENDP
