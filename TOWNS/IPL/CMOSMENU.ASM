
CMOSMENU_NUM_ITEMS_ICM	EQU	7
CMOSMENU_NUM_ITEMS_OTHER	EQU	4

CMOSMENU_JUMP_TABLE		DW	OFFSET CMOSMENU_BACK_TO_MAINMENU
						DW	OFFSET CMOSMENU_DRIVE_LETTER
						DW	OFFSET CMOSMENU_RESET_CMOS
						DW	OFFSET CMOSMENU_FASTMODE
						DW	OFFSET CMOSMENU_AUTO_RESTORE
						DW	OFFSET CMOSMENU_BACKUP
						DW	OFFSET CMOSMENU_RESTORE


CMOSMENU_ITEMS			DB	"BACK TO MAIN MENU",0
						DB	"DRIVE LETTER ASSIGNMENT",0
						DB	"RESET CMOS",0
CMOSMENU_FASTMODE_MENU	DB	"[ ] FAST MODE",0
CMOSMENU_AUTO_RESTORE_MENU	DB	"[ ] AUTO CMOS RESTORE FROM MEMORY CARD",0
						DB  "BACK UP CMOS TO MEMORY CARD NOW",0
						DB	"RESTORE CMOS FROM MEMORY CARD NOW",0
CMOSMENU_ITEMS_END:

CMOSMENU_NUM_ITEMS		DB	CMOSMENU_NUM_ITEMS_OTHER
CMOSMENU_SELECTION		DB	0



CMOSMENU				PROC
						MOV		BYTE PTR CS:[CMOSMENU_SELECTION],0

						MOV		BX,CS:[INCOMING_BX]
						AND		BX,0F0FH

						MOV		AL,CMOSMENU_NUM_ITEMS_ICM
						CMP		BL,4		; ICM?
						JE		SHORT CMOSMENU_BOOT_FROM_ICM
						MOV		AL,CMOSMENU_NUM_ITEMS_OTHER

CMOSMENU_BOOT_FROM_ICM:
						MOV		CS:[CMOSMENU_NUM_ITEMS],AL


CMOSMENU_OUTERLOOP:
						CALL	MENU_WAIT_PAD_RELEASE
						CALL	CLEAR_FIVE_BELOW
						CALL	CMOSMENU_RESET

						MOVZX	CX,CS:[CMOSMENU_NUM_ITEMS]
						MOV		SI,OFFSET CMOSMENU_ITEMS
						CALL	DRAWMENU2

CMOSMENU_INNER_LOOP:
						MOVZX	CX,CS:[CMOSMENU_NUM_ITEMS]
						MOV		AL,CS:[CMOSMENU_SELECTION]
						CALL	DRAWARROW

CMOSMENU_WAIT_PAD:
						CALL	READ_PADA
						CMP		AL,3FH
						JE		CMOSMENU_WAIT_PAD

						; Input
						;   AL Pad
						;   AH Current Selection
						;   CH Number of Choices
						; Output
						;   AH New Selection
						MOV		AH,CS:[CMOSMENU_SELECTION]
						MOV		CH,CS:[CMOSMENU_NUM_ITEMS]
						CALL	MOVE_ARROW_BY_PAD
						MOV		CS:[CMOSMENU_SELECTION],AH

						AND		AL,30H
						CMP		AL,30H
						JE		CMOSMENU_INNER_LOOP

						MOVZX	BX,CS:[CMOSMENU_SELECTION]
						SHL		BX,1
						JMP		CS:[CMOSMENU_JUMP_TABLE+BX]

CMOSMENU_DRIVE_LETTER:
						CALL	DRVMENU
						JMP		CMOSMENU_OUTERLOOP
CMOSMENU_RESET_CMOS:
						CALL	CMOSRESET_CONFIRM
						JMP		CMOSMENU_OUTERLOOP
CMOSMENU_FASTMODE:
						JMP		CMOSMENU_OUTERLOOP
CMOSMENU_AUTO_RESTORE:
						JMP		CMOSMENU_OUTERLOOP
CMOSMENU_BACKUP:
						JMP		CMOSMENU_OUTERLOOP
CMOSMENU_RESTORE:
						JMP		CMOSMENU_OUTERLOOP

CMOSMENU_BACK_TO_MAINMENU:
						RET

CMOSMENU				ENDP



CMOSMENU_RESET			PROC
						RET
CMOSMENU_RESET			ENDP
